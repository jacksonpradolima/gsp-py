name: SLSA provenance for releases

on:
  workflow_dispatch:
  push:
    tags:
      - 'v*'

permissions: {}

jobs:
  provenance:
    name: Generate SLSA provenance
    uses: slsa-framework/slsa-github-generator/.github/workflows/generator_generic_slsa3.yml@v1.10.0
    permissions:
      actions: read
      contents: write
      id-token: write
    with:
      build-command: |
        python -m pip install --upgrade pip
        pip install build
        python -m build
        mkdir -p artifacts
        shopt -s nullglob
        cp dist/*.whl dist/*.tar.gz artifacts/
      provenance-name: gsppy-provenance.intoto.jsonl
      upload-assets: true
